{% extends "base.html" %}

{% load static %}

{% block content %}

{% include 'sidebar.html' %}

<div class="flex-1 bg-white p-8 md:p-4 lg:p-4 xl:p-8 min-h-full">
    {% include 'navbar.html' %}
    <div class="md:flex justify-between mb-8">
        <div class="flex justify-between items-center py-2">
            <div class="flex space-x-4 md:space-x-2 lg:space-x-4 justify-between items-center">
                <button id="preview-btn" class="flex items-center justify-between gap-2 border-2 border-gray-400 shadow-sm text-gray-600 px-3 py-2 rounded-md text-sm font-bold">
                    <svg class="w-5 h-5" fill="#000000" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <g> <rect x="311.652" y="33.391" width="33.391" height="33.391"></rect> </g> </g> <g> <g> <rect x="66.783" y="200.348" width="133.565" height="33.391"></rect> </g> </g> <g> <g> <rect x="66.783" y="289.391" width="100.174" height="33.391"></rect> </g> </g> <g> <g> <rect x="66.783" y="378.435" width="100.174" height="33.391"></rect> </g> </g> <g> <g> <rect x="200.348" y="267.13" width="33.391" height="111.304"></rect> </g> </g> <g> <g> <rect x="233.739" y="233.739" width="33.391" height="33.391"></rect> </g> </g> <g> <g> <rect x="233.739" y="378.435" width="33.391" height="33.391"></rect> </g> </g> <g> <g> <g> <rect x="411.826" y="267.13" width="33.391" height="144.696"></rect> <rect x="445.217" y="411.826" width="33.391" height="33.391"></rect> </g> </g> </g> <g> <g> <g> <polygon points="267.13,411.826 267.13,445.217 345.043,445.217 345.043,478.609 33.391,478.609 33.391,33.391 244.87,33.391 244.87,133.565 345.043,133.565 345.043,200.348 267.13,200.348 267.13,233.739 378.435,233.739 378.435,66.783 345.043,66.783 345.043,100.174 278.261,100.174 278.261,33.391 311.652,33.391 311.652,0 0,0 0,33.391 0,478.609 0,512 378.435,512 378.435,445.217 411.826,445.217 411.826,411.826 "></polygon> <rect x="378.435" y="233.739" width="33.391" height="33.391"></rect> <rect x="411.826" y="445.217" width="33.391" height="33.391"></rect> </g> </g> </g> <g> <g> <polygon points="478.609,445.217 478.609,478.609 445.217,478.609 445.217,512 512,512 512,445.217 "></polygon> </g> </g> <g> <g> <rect x="267.13" y="267.13" width="111.304" height="111.304"></rect> </g> </g> </g></svg>
                    Preview
                </button>
                <div class="relative">
                    <button id="sort-btn" class="flex items-center justify-between gap-2 border-2 border-gray-400 shadow-sm text-gray-600 px-3 py-2 rounded-md text-sm font-bold">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M11.1924 5.65685C11.5829 5.26633 11.5829 4.63316 11.1924 4.24264L8.36397 1.41421C8.30576 1.356 8.24485 1.30212 8.18165 1.25259C7.50286 0.720577 6.55947 0.689024 5.84929 1.15793C5.73839 1.23115 5.63317 1.31658 5.53554 1.41421L2.70711 4.24264C2.31658 4.63316 2.31658 5.26633 2.70711 5.65685C3.09763 6.04738 3.7308 6.04738 4.12132 5.65685L6.00003 3.77814V18C6.00003 18.5523 6.44775 19 7.00003 19C7.55232 19 8.00003 18.5523 8.00003 18V3.8787L9.77818 5.65685C10.1687 6.04737 10.8019 6.04737 11.1924 5.65685Z" fill="#0F0F0F"></path> <path d="M12.7071 18.3432C12.3166 18.7337 12.3166 19.3668 12.7071 19.7574L15.5355 22.5858C15.6332 22.6834 15.7384 22.7689 15.8493 22.8421C16.6256 23.3546 17.6805 23.2692 18.364 22.5858L21.1924 19.7574C21.5829 19.3668 21.5829 18.7337 21.1924 18.3432C20.8019 17.9526 20.1687 17.9526 19.7782 18.3432L18 20.1213L18 6C18 5.44771 17.5523 5 17 5C16.4477 5 16 5.44771 16 6L16 20.2218L14.1213 18.3432C13.7308 17.9526 13.0976 17.9526 12.7071 18.3432Z" fill="#0F0F0F"></path> </g></svg>
                        Sort
                    </button>
                    <div id="sort-dropdown" class="absolute hidden bg-white shadow-lg rounded-md mt-1 w-40 py-1 z-10">
                        <a href="?sort=priority" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Priority</a>
                        <a href="?sort=due_date" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Due Date (asc)</a>
                        <a href="?sort=-due_date" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Due Date (desc)</a>
                        <a href="?sort=category" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Category</a>
                    </div>
                </div>

                <div class="relative">
                    <button id="filter-btn" class="flex items-center justify-between gap-2 border-2 border-gray-400 shadow-sm text-gray-600 px-3 py-2 rounded-md text-sm font-bold">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>Filter</title> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Filter"> <rect id="Rectangle" fill-rule="nonzero" x="0" y="0" width="24" height="24"> </rect> <line x1="4" y1="5" x2="16" y2="5" id="Path" stroke="#0C0310" stroke-width="2" stroke-linecap="round"> </line> <line x1="4" y1="12" x2="10" y2="12" id="Path" stroke="#0C0310" stroke-width="2" stroke-linecap="round"> </line> <line x1="14" y1="12" x2="20" y2="12" id="Path" stroke="#0C0310" stroke-width="2" stroke-linecap="round"> </line> <line x1="8" y1="19" x2="20" y2="19" id="Path" stroke="#0C0310" stroke-width="2" stroke-linecap="round"> </line> <circle id="Oval" stroke="#0C0310" stroke-width="2" stroke-linecap="round" cx="18" cy="5" r="2"> </circle> <circle id="Oval" stroke="#0C0310" stroke-width="2" stroke-linecap="round" cx="12" cy="12" r="2"> </circle> <circle id="Oval" stroke="#0C0310" stroke-width="2" stroke-linecap="round" cx="6" cy="19" r="2"> </circle> </g> </g> </g></svg>
                        Filter
                    </button>
                    <div id="filter-dropdown" class="absolute hidden bg-white shadow-lg rounded-md mt-1 w-40 py-1 z-10">
                        <a href="?filter=priority" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Priority</a>
                        <a href="?filter=due_date" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Due Date (asc)</a>
                        <a href="?filter=-due_date" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Due Date (desc)</a>
                        <a href="?filter=category" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Category</a>
                    </div>
                </div>
            </div>    
        </div>

        <div class="flex justify-between items-center">
            <div class="flex justify-between">
                <div class="flex space-x-2 items-center">
                    <div class="rounded-full w-5 h-5">
                        <img src="{% static 'images/image1.png' %}" class="rounded-full w-5 h-5" alt="User 1">
                    </div>
                    <div class="rounded-full w-5 h-5">
                        <img src="{% static 'images/image2.png' %}" class="rounded-full w-5 h-5 -ml-3 z-10" alt="User 2">
                    </div>
                    <div class="rounded-full w-5 h-5">
                        <img src="{% static 'images/image3.png' %}" class="rounded-full w-5 h-5 -ml-6 z-20" alt="User 3">
                    </div>
                    <div class="rounded-full w-5 h-5">
                        <img src="{% static 'images/image2.png' %}" class="rounded-full w-5 h-5 -ml-9 z-30" alt="User 2">
                    </div>
                    <div class="rounded-full w-5 h-5">
                        <div class="rounded-full bg-blue-500 w-5 h-5 -ml-12 z-40 flex items-center justify-center text-white text-xs">+2</div>
                    </div>
                </div>
                <div class="w-5 h-5 flex items-center justify-center border-dashed border-gray-400 border rounded-full text-gray-600 -ml-7 mr-8 md:mr-5 lg:mr-8">
                    <p class="flex justify-center items-center text-lg font-bold">+</p>
                </div>                   
            </div>

            <a href="{% url 'task_create' %}" class="bg-blue-800 text-white px-4 md:px-2 lg:px-4 py-2 rounded">+ Add Task</a>
        </div>
    </div>

    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        <div id="in_progress" class="py-4 md:pr-1 lg:pr-2 xl:pr-8 rounded-md">
            <div class="flex justify-between rounded-md border-2 border-blue-400 px-2 mb-2">
                <h3 class="flex justify-center items-center gap-2 text-lg font-semibold text-gray-700">
                    In Progress <span id="in_progress_count" class="text-gray-400">(0)</span>
                </h3>
                <button type="button" class="inline-flex justify-center rounded-md shadow-sm py-2 text-sm font-medium text-gray-700 focus:outline-none dropdown-toggle">
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M6 10a2 2 0 114-0 2 2 0 01-4 0zM6 15a2 2 0 114-0 2 2 0 01-4 0zM6 5a2 2 0 114-0 2 2 0 01-4 0z"/>
                    </svg>
                </button>
            </div>
            <div id="in_progress_tasks" class="task-column my-5 min-h-full" ondragover="allowDrop(event)" ondrop="drop(event)"></div>
        </div>
        <div id="completed" class="py-4 md:px-1 lg:px-1 xl:px-4 rounded-md">
            <div class="flex justify-between rounded-md border-2 border-blue-400 px-2 mb-2">
                <h3 class="flex justify-center items-center gap-2 text-lg font-semibold text-gray-700">
                    Completed Task <span id="completed_count" class="text-gray-400">(0)</span>
                </h3>
                <button type="button" class="inline-flex justify-center rounded-md shadow-sm py-2 text-sm font-medium text-gray-700 focus:outline-none dropdown-toggle">
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M6 10a2 2 0 114-0 2 2 0 01-4 0zM6 15a2 2 0 114-0 2 2 0 01-4 0zM6 5a2 2 0 114-0 2 2 0 01-4 0z"/>
                    </svg>
                </button>
            </div>
            <div id="completed_tasks" class="task-column my-5 min-h-full" ondragover="allowDrop(event)" ondrop="drop(event)"></div>
        </div>
        <div id="overdue" class="py-4 md:pl-1 lg:pl-2 xl:pl-8 rounded-md">
            <div class="flex justify-between rounded-md border-2 border-blue-400 px-2 mb-2">
                <h3 class="flex justify-center items-center gap-2 text-lg font-semibold text-gray-700">
                    Over-Due <span id="overdue_count" class="text-gray-400">(0)</span>
                </h3>
                <button type="button" class="inline-flex justify-center rounded-md shadow-sm py-2 text-sm font-medium text-gray-700 focus:outline-none dropdown-toggle">
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M6 10a2 2 0 114-0 2 2 0 01-4 0zM6 15a2 2 0 114-0 2 2 0 01-4 0zM6 5a2 2 0 114-0 2 2 0 01-4 0z"/>
                    </svg>
                </button>
            </div>
            <div id="overdue_tasks" class="task-column my-5 min-h-full" ondragover="allowDrop(event)" ondrop="drop(event)"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    function formatDueDate(dateTimeStr) {
        const dueDate = new Date(dateTimeStr);
        const currentDate = new Date();

        if (dueDate.toDateString() === currentDate.toDateString()) {
            return dueDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });
        }

        const tomorrow = new Date(currentDate);
        tomorrow.setDate(currentDate.getDate() + 1);
        if (dueDate.toDateString() === tomorrow.toDateString()) {
            return 'Tomorrow';
        }

        const formattedDate = dueDate.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: '2-digit' });
        return formattedDate;
    }

    function loadTasks(status, container, countElementId, sortBy) {
        let url = "{% url 'api_tasks' %}?status=" + status;
        if (sortBy) {
            url += "&sort_by=" + sortBy;
        }

        $.ajax({
            // url: "{% url 'api_tasks' %}",
            url: url,
            data: {status: status},
            success: function(data) {
                var html = '';
                data.forEach(function(task) {
                    var dueDateFormatted = formatDueDate(task.due_date);

                    html += `
                        <div class="task cursor-move shadow-xs" draggable="true" id="${task.id}" data-status="${task.status}" ondragstart="drag(event)">
                            <div class="flex justify-between items-center py-2 mt-8">
                                <div class="flex space-x-3 md:space-x-2 lg:space-x-1 xl:space-x-4 justify-between items-center">
                                    <span class="bg-red-300 text-gray-700 px-3 py-2 rounded-md text-xs font-semibold">${task.priority}</span>
                                    <span class="bg-white shadow-md text-purple-400 px-3 py-2 rounded-md text-xs font-semibold flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m5-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        ${dueDateFormatted}
                                    </span>
                                    <span class="bg-purple-100 text-purple-600 px-3 py-2 rounded-md text-xs font-semibold">${task.category}</span>
                                </div>    
                            </div>
                            <div class="task py-3 px-2 mb-2 rounded-md shadow-md bg-gray-200">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-lg text-gray-800 font-semibold">${task.title}</h3>
                                    <div class="relative inline-block text-left">
                                        <button type="button" class="inline-flex justify-center w-full rounded-md py-2 text-sm font-medium text-gray-700 focus:outline-none dropdown-toggle" id="options-menu-${task.id}" aria-expanded="true" aria-haspopup="true">
                                            <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path d="M6 10a2 2 0 114-0 2 2 0 01-4 0zM6 15a2 2 0 114-0 2 2 0 01-4 0zM6 5a2 2 0 114-0 2 2 0 01-4 0z"/>
                                            </svg>
                                        </button>
                                        <div class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none dropdown-menu hidden" role="menu" aria-orientation="vertical" aria-labelledby="options-menu-${task.id}">
                                            <div class="py-1" role="none">
                                                <a href="/tasks/task/${task.id}/edit/" class="text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100" role="menuitem">Edit</a>
                                                <a href="/tasks/task/${task.id}/delete/confirm/" class="text-gray-700 block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Delete</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-gray-600 overflow-hidden line-clamp-2 h-12">${task.description}</p>
                                <div class="flex justify-start mt-3 mb-1">
                                    <div class="flex justify-between rounded border border-lg px-1 border-gray-400">
                                        <span class="text-gray-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-list" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <line x1="9" y1="6" x2="20" y2="6" />
                                                <line x1="9" y1="12" x2="20" y2="12" />
                                                <line x1="9" y1="18" x2="20" y2="18" />
                                                <line x1="5" y1="6" x2="5" y2="6.01" />
                                                <line x1="5" y1="12" x2="5" y2="12.01" />
                                                <line x1="5" y1="18" x2="5" y2="18.01" />
                                            </svg>
                                        </span>
                                        <span class="text-gray-400">0/3</span>
                                    </div>
                                </div>
                                <div class="flex justify-between">
                                    <div class="flex justify-between mt-2">
                                        <div class="flex space-x-2 items-center">
                                            <div class="rounded-full w-5 h-5">
                                                <img src="{% static 'images/image1.png' %}" class="rounded-full w-5 h-5" alt="User 1">
                                            </div>
                                            <div class="rounded-full w-5 h-5">
                                                <img src="{% static 'images/image2.png' %}" class="rounded-full w-5 h-5 -ml-3 z-10" alt="User 2">
                                            </div>
                                            <div class="rounded-full w-5 h-5">
                                                <img src="{% static 'images/image3.png' %}" class="rounded-full w-5 h-5 -ml-6 z-20" alt="User 3">
                                            </div>
                                            <div class="rounded-full w-5 h-5">
                                                <div class="rounded-full bg-blue-500 w-5 h-5 -ml-9 z-30 flex items-center justify-center text-white text-xs">+2</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-end space-x-2 mt-2">
                                        <a href="/tasks/task/${task.id}/" class="text-blue-500">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-eye" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <circle cx="12" cy="12" r="2" />
                                                <path d="M22 12c-1.656 -3.422 -5.1 -6 -10 -6s-8.344 2.578 -10 6c1.656 3.422 5.1 6 10 6s8.344 -2.578 10 -6" />
                                            </svg>
                                        </a>
                                        <a href="/tasks/task/${task.id}/delete/confirm/" class="text-red-500">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <line x1="4" y1="7" x2="20" y2="7" />
                                                <line x1="10" y1="11" x2="10" y2="17" />
                                                <line x1="14" y1="11" x2="14" y2="17" />
                                                <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                                                <path d="M9 7v-3h6v3" />
                                            </svg>
                                        </a>
                                        <a href="/tasks/task/${task.id}/edit/" class="text-blue-500">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M4 20h4l11 -11a2.828 2.828 0 0 0 -4 -4l-11 11v4" />
                                                <path d="M13.5 6.5l4 4" />
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                $('#' + container).html(html);
                $('#' + countElementId).text('(' + data.length + ')');

                $('.dropdown-toggle').click(function() {
                    $(this).siblings('.dropdown-menu').toggle();
                });

                $(document).click(function(e) {
                    if (!$(e.target).closest('.dropdown-toggle').length) {
                        $('.dropdown-menu').hide();
                    }
                });
            }
        });
    }

    loadTasks('In_progress', 'in_progress_tasks', 'in_progress_count');
    loadTasks('Completed', 'completed_tasks', 'completed_count');
    loadTasks('Overdue', 'overdue_tasks', 'overdue_count');


    // Sort button click handler
    $('#sort-btn').click(function() {
        // Define your sorting logic here
        // For demonstration, let's sort by title ascending
        const sortBy = 'title'; // Replace with actual sorting criteria

        // Reload tasks with sorting criteria
        loadTasks('In_progress', 'in_progress_tasks', 'in_progress_count', sortBy);
        loadTasks('Completed', 'completed_tasks', 'completed_count', sortBy);
        loadTasks('Overdue', 'overdue_tasks', 'overdue_count', sortBy);
    });

    // Filter button click handler
    $('#filter-btn').click(function() {
        // Define your filtering logic here
        // For demonstration, let's filter by priority
        const filterBy = 'priority'; // Replace with actual filtering criteria

        // Reload tasks with filtering criteria
        loadTasks('In_progress', 'in_progress_tasks', 'in_progress_count', filterBy);
        loadTasks('Completed', 'completed_tasks', 'completed_count', filterBy);
        loadTasks('Overdue', 'overdue_tasks', 'overdue_count', filterBy);
    });
});




// drag-and-drop

function allowDrop(ev) {
    ev.preventDefault();
    // console.log(ev.target.id);
}

function drag(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
    // console.log(ev.target.id);
}

function drop(ev) {
    ev.preventDefault();
    var data = ev.dataTransfer.getData("text");
    var taskElement = document.getElementById(data);
    var newStatus = ev.target.id;

    if (newStatus === 'completed_tasks') {
        newStatus = 'Completed';
    } else if (newStatus === 'overdue_tasks') {
        newStatus = 'Overdue';
    } else if (newStatus === 'in_progress_tasks') {
        newStatus = 'In_progress';
    } else {
        newStatus;
    }
    
    // Ensure we drop in the correct container
    console.log(ev.target.className);
    if (ev.target.classList.contains('task-column')) {
        // console.log(ev.target.className);
        ev.target.appendChild(taskElement);
        taskElement.dataset.status = newStatus;
        // console.log(taskElement.dataset.status);

        // Update status on the server
        updateTaskStatus(data, newStatus);
    }
}

function updateTaskStatus(taskId, newStatus) {
    fetch('/update-task-status/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            taskId: taskId,
            newStatus: newStatus
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('Task status updated successfully');
        } else {
            console.error('Error updating task status:', data.error);
        }
    })
    .catch(error => console.error('Error:', error));
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}




// sort
document.getElementById('sort-btn').addEventListener('click', function() {
    var sortDropdown = document.getElementById('sort-dropdown');
    if (sortDropdown.classList.contains('hidden')) {
        sortDropdown.classList.remove('hidden');
    } else {
        sortDropdown.classList.add('hidden');
    }
});

// filter
document.getElementById('filter-btn').addEventListener('click', function() {
    var filterDropdown = document.getElementById('filter-dropdown');
    if (filterDropdown.classList.contains('hidden')) {
        filterDropdown.classList.remove('hidden');
    } else {
        filterDropdown.classList.add('hidden');
    }
});

</script>
{% endblock %}

